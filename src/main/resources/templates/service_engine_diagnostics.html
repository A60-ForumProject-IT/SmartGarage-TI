<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<form th:replace="~{FragmentForm.html :: head}"></form>
<body>
<div class="site-container">
    <form th:replace="~{FragmentForm.html :: header-icons-info}"></form>
    <form th:replace="~{FragmentForm.html :: header-container}"></form>
    <div class="theme-page">
        <div class="row gray full-width page-header vertical-align-table">
            <div class="row full-width padding-top-bottom-50 vertical-align-cell">
                <div class="row">
                    <div class="page-header-left">
                        <h1>ENGINE DIAGNOSTICS</h1>
                    </div>
                    <div class="page-header-right">
                        <div class="bread-crumb-container">
                            <label>YOU ARE HERE:</label>
                            <ul class="bread-crumb">
                                <li>
                                    <a title="HOME" th:href="@{/ti}" href="index.html">
                                        HOME
                                    </a>
                                </li>
                                <li class="separator">
                                    &#47;
                                </li>
                                <li>
                                    <a title="Our Services" th:href="@{/ti/services}" href="services.html">
                                        OUR SERVICES
                                    </a>
                                </li>
                                <li class="separator">
                                    &#47;
                                </li>
                                <li>
                                    ENGINE DIAGNOSTICS
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix">
            <div class="row margin-top-70">
                <div class="column column-1-4">
                    <ul class="vertical-menu">
                        <li>
                            <a href="service_engine_diagnostics.html" th:href="@{/ti/services/engine-diagnostics}"
                               title="Engine Diagnostics">
                                Engine Diagnostics
                                <span class="template-arrow-menu"></span>
                            </a>
                        </li>
                        <li>
                            <a href="service_lube_oil_filters.html" th:href="@{/ti/services/lube-oil-filters}"
                               title="Lube, Oil and Filters">
                                Lube, Oil and Filters
                                <span class="template-arrow-menu"></span>
                            </a>
                        </li>
                        <li>
                            <a href="service_belts_hoses.html" th:href="@{/ti/services/belts-hoses}"
                               title="Belts and Hoses">
                                Belts and Hoses
                                <span class="template-arrow-menu"></span>
                            </a>
                        </li>
                        <li class="selected">
                            <a href="service_air_conditioning.html" th:href="@{/ti/services/air-conditioning}"
                               title="Air Conditioning">
                                Air Conditioning
                                <span class="template-arrow-menu"></span>
                            </a>
                        </li>
                        <li>
                            <a href="service_brake_repair.html" th:href="@{/ti/services/brake-repair}"
                               title="Brake Repair">
                                Brake Repair
                                <span class="template-arrow-menu"></span>
                            </a>
                        </li>
                        <li>
                            <a href="service_tire_wheel.html" th:href="@{/ti/services/tire-wheel}"
                               title="Tire and Wheel Services">
                                Tire and Wheel Services
                                <span class="template-arrow-menu"></span>
                            </a>
                        </li>
                    </ul>
                    <div class="call-to-action page-margin-top">
                        <div class="hexagon small">
                            <div class="sl-small-percent"></div>
                        </div>
                        <h4 class="margin-top-58">ONLINE APPOINTMENT</h4>
                        <p class="description">Book your appointment now!</p>
                        <a class="more" href="appointment.html" th:href="@{/ti/appointment}"
                           title="MAKE APPOINTMENT"><span>MAKE APPOINTMENT</span></a>
                    </div>
                </div>
                <div class="column column-3-4">
                    <div class="row">
                        <div class="column column-1-2">
                            <a href="images/samples/870x580/image_01.jpg"
                               th:href="@{/images/samples/870x580/image_01.jpg}" class="prettyPhoto re-preload"
                               title="Engine Diagnostics">
                                <img src='images/samples/480x320/image_01.jpg'
                                     th:src="@{/images/samples/480x320/image_01.jpg}" alt='img'>
                            </a>
                        </div>
                        <div class="column column-1-2">
                            <a href="images/samples/870x580/image_09.jpg"
                               th:href="@{/images/samples/870x580/image_09.jpg}" class="prettyPhoto re-preload"
                               title="Engine Diagnostics">
                                <img src='images/samples/480x320/image_09.jpg'
                                     th:src="@{/images/samples/480x320/image_09.jpg}" alt='img'>
                            </a>
                        </div>
                    </div>
                    <div class="row page-margin-top">
                        <div class="column-1-1">
                            <h3 class="box-header">SERVICE OVERVIEW</h3>
                            <p class="margin-top-20">We provide a comprehensive range of garage services to vehicle
                                owners in Sofia. Our experienced team is equipped to handle various car services,
                                ensuring each vehicle receives top-notch care. Whether you drive a compact car, a sedan,
                                or a larger SUV, our mechanics are dedicated to delivering optimal performance before
                                you hit the road.</p>
                            <p>From routine maintenance like oil changes to more complex repairs, we cover it all. Our
                                expertise extends to both foreign and domestic vehicles, ensuring reliable and quality
                                service for every car that enters our garage.</p>
                            <h3 class="box-header page-margin-top">PRICING</h3>
                            <table class="margin-top-40" id="servicesTable">
                                <tbody>
                                <tr th:each="service : ${services}" th:data-service-id="${service.id}">
                                    <td th:id="'service-name-' + ${service.id}" th:text="${service.name}">Service Name
                                    </td>
                                    <td th:id="'service-price-' + ${service.id}"
                                        th:utext="'Starts from <span style=&quot;font-weight: bold;&quot;>' + ${#numbers.formatDecimal(service.price, 2, 2)} + '</span> BGN'">
                                        Service Price
                                    </td>
                                    <td th:if="${isEmployee}" style="text-align: right;">
                                        <button class="more simple" th:id="'edit-' + ${service.id}"
                                                style="padding: 5px 10px; font-size: 12px; margin-right: 10px;"
                                                th:onclick="'editService(' + ${service.id} + ', \'' + ${slug} + '\')'">
                                            Edit
                                        </button>
                                        <button class="more simple" th:id="'save-' + ${service.id}"
                                                style="display:none; padding: 5px 10px; font-size: 12px; margin-right: 10px;"
                                                th:onclick="'saveEditedService(' + ${service.id} + ', \'' + ${slug} + '\')'">
                                            Save
                                        </button>

                                        <form th:action="@{/ti/services/engine-diagnostics/delete}" method="post"
                                              style="display:inline;" onsubmit="return confirmDelete();">
                                            <input type="hidden" th:name="serviceId" th:value="${service.id}">
                                            <button class="more simple" th:id="'delete-' + ${service.id}"
                                                    style="padding: 5px 10px; font-size: 12px; margin-right: 10px;"
                                                    type="submit">Delete
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                </tbody>
                            </table>

                            <div th:if="${isEmployee}" style="text-align: center;">
                                <a href="javascript:void(0);" id="addServiceButton" class="more simple"
                                   style="padding: 5px 10px; font-size: 12px; margin-right: 10px;"
                                   onclick="addNewServiceRow()">Add Service</a>
                                <div id="saveButtonContainer" style="display: flex; justify-content: center;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row page-margin-top padding-bottom-70">
                        <div class="column column-1-2">
                            <h4 class="box-header">WHY CHOOSE US</h4>
                            <p class="margin-top-20">Our garage offers top-tier services to vehicle owners in Sofia.
                                From routine maintenance to complex repairs, we have the expertise to handle all types
                                of cars, ensuring your vehicle is in safe hands.</p>
                            <ul class="list margin-top-20">
                                <li class="template-bullet">We prioritize your convenience and schedule</li>
                                <li class="template-bullet">Our team consists of certified and experienced technicians
                                </li>
                                <li class="template-bullet">We provide a comprehensive range of automotive services</li>
                                <li class="template-bullet">Most repairs and services completed within the same day</li>
                                <li class="template-bullet">Our commitment is to quality and getting it right â€” every
                                    time
                                </li>
                            </ul>
                        </div>
                        <div class="column column-1-2">
                            <h4 class="box-header">POPULAR QUESTIONS</h4>
                            <ul class="accordion margin-top-40 clearfix">
                                <li>
                                    <div id="accordion-tire-rotation">
                                        <h4>How often should I rotate my tires?</h4>
                                    </div>
                                    <p>Tire rotation is recommended every 10,000 to 12,000 km to ensure even tire wear,
                                        extend tire life, and maintain optimal performance and safety.</p>
                                </li>
                                <li>
                                    <div id="accordion-brake-fluid-change">
                                        <h4>When should I change my brake fluid?</h4>
                                    </div>
                                    <p>Brake fluid should be replaced every 2 years or 40,000 km. Regular replacement
                                        prevents corrosion and maintains effective braking performance.</p>
                                </li>
                                <li>
                                    <div id="accordion-car-battery-check">
                                        <h4>How do I know if my car battery needs checking?</h4>
                                    </div>
                                    <p>If you experience slow engine crank, dimming headlights, or frequent electronic
                                        issues, it's time to have your battery tested for optimal performance.</p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <form th:replace="~{FragmentForm.html :: footer-and-copyright}"></form>
</div>
<a href="#top" class="scroll-top animated-element template-arrow-up" title="Scroll to top"></a>
<div class="background-overlay"></div>
<!--js-->
<script type="text/javascript" th:src="@{/js/jquery-3.6.0.min.js}"></script>
<!--slider revolution-->
<script type="text/javascript" th:src="@{/plugins/rs-plugin/js/jquery.themepunch.tools.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/rs-plugin/js/jquery.themepunch.revolution.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.ba-bbq.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery-ui-1.12.1.custom.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.ui.touch-punch.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.isotope.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.easing.1.4.1.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.carouFredSel-6.2.1-packed.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.touchSwipe.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.transit.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.hint.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.costCalculator.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.prettyPhoto.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.qtip.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.blockUI.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.imagesloaded-packed.js}"></script>
<script type="text/javascript" th:src="@{/js/main.js}"></script>
<script type="text/javascript" th:src="@{/js/odometer.min.js}"></script>
<script th:fragment="add-services-button">
    function addNewServiceRow() {
        var table = document.getElementById("servicesTable");
        var tbody = table.getElementsByTagName('tbody')[0];
        var newRow = tbody.insertRow(-1);

        var nameCell = newRow.insertCell(0);
        var priceCell = newRow.insertCell(1);

        var nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.name = 'serviceName';
        nameInput.placeholder = 'Enter service name';
        nameInput.required = true;

        var priceInput = document.createElement('input');
        priceInput.type = 'number';
        priceInput.name = 'servicePrice';
        priceInput.placeholder = 'Enter price';
        priceInput.step = '0.01';
        priceInput.required = true;

        nameCell.appendChild(nameInput);
        priceCell.appendChild(priceInput);

        var addButton = document.getElementById("addServiceButton");
        addButton.style.display = "none";

        var saveButtonContainer = document.getElementById("saveButtonContainer");
        saveButtonContainer.innerHTML = '';
        var saveButton = document.createElement("a");
        saveButton.href = "javascript:void(0);";
        saveButton.className = "more simple";
        saveButton.style = "padding: 5px 10px; font-size: 12px; margin-top: 20px;";
        saveButton.textContent = "Save Service";
        saveButton.onclick = function () {
            if (!nameInput.value || !priceInput.value) {
                alert('Please fill in all required fields.');
                return;
            }

            saveService(nameInput.value, priceInput.value);

            saveButtonContainer.innerHTML = '';
            addButton.style.display = "inline-block";
        };

        saveButtonContainer.appendChild(saveButton);
    }

    function saveService(name, price) {
        var pathParts = window.location.pathname.split('/');
        var slug = pathParts[pathParts.length - 1];

        fetch('/ti/services/' + slug + '/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: name,
                price: price
            })
        })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    return response.text().then(text => {
                        throw new Error(text);
                    });
                }
            })
            .catch(error => console.error('Error:', error));
    }
</script>
<script>
    function editService(serviceId, slug) {
        console.log(`Editing service with ID: ${serviceId}, for slug: ${slug}`);

        const rowElement = document.querySelector(`tr[data-service-id="${serviceId}"]`);

        if (!rowElement) {
            console.error(`Row with serviceId ${serviceId} not found.`);
            return;
        }

        const nameElement = rowElement.querySelector(`td[id="service-name-${serviceId}"]`);
        const priceElement = rowElement.querySelector(`td[id="service-price-${serviceId}"]`);

        if (!nameElement || !priceElement) {
            console.error(`Elements with serviceId ${serviceId} not found.`);
            return;
        }

        nameElement.innerHTML = `<input type="text" value="${nameElement.textContent.trim()}" id="input-name-${serviceId}">`;
        priceElement.innerHTML = `<input type="number" value="${priceElement.textContent.replace(/[^0-9.-]+/g, '').trim()}" step="0.01" id="input-price-${serviceId}">`;

        const saveButton = rowElement.querySelector(`#save-${serviceId}`);
        const editButton = rowElement.querySelector(`#edit-${serviceId}`);
        const deleteButton = rowElement.querySelector(`#delete-${serviceId}`);

        saveButton.style.display = 'inline-block';
        editButton.style.display = 'none';
        deleteButton.style.display = 'none';
    }

    function saveEditedService(serviceId, slug) {
        if (!slug) {
            console.error("Slug is missing or invalid.");
            return;
        }

        const name = document.getElementById(`input-name-${serviceId}`).value;
        const price = document.getElementById(`input-price-${serviceId}`).value;

        console.log(`Saving service with ID: ${serviceId}, for slug: ${slug}`);

        fetch(`/ti/services/${slug}/edit?serviceId=${serviceId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                name: name,
                price: price
            })
        })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    return response.text().then(text => {
                        throw new Error(text);
                    });
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function deleteService(serviceId, slug) {
        if (!confirm("Are you sure you want to delete this service?")) {
            return;
        }

        console.log(`Deleting service with ID: ${serviceId}, for slug: ${slug}`);

        fetch(`/ti/services/${slug}/delete?serviceId=${serviceId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    return response.text().then(text => {
                        throw new Error(text);
                    });
                }
            })
            .catch(error => console.error('Error:', error));
    }

    function confirmDelete() {
        return confirm("Are you sure you want to delete this service?");
    }
</script>
</body>
</html>